version: '3.8'

services:
  # --- Servicio del Frontend ---
  frontend:
    build:
      context: ./frontend1.2 # Directorio donde está el Dockerfile del frontend
      dockerfile: Dockerfile
    container_name: frontend_service
    ports:
      - "4200:80" # Mapea el puerto 4200 de tu máquina al puerto 80 del contenedor Nginx

  # --- API Gateway ---
  api-gateway:
    build:
      context: ./backend1.0/api-gateway
      dockerfile: Dockerfile
    container_name: api_gateway_service
    ports:
      - "8080:8080" # Puerto principal de entrada al backend
    depends_on: # El gateway no arrancará hasta que los servicios de los que depende estén listos
      - obras-service
      - clientes-service
      - proveedores-service
      - documentos-service
      - transacciones-service
      - reportes-service
    environment: # Variables para que el gateway sepa dónde encontrar los otros servicios
      - OBRAS_SERVICE_URL=http://obras-service:8081
      - CLIENTES_SERVICE_URL=http://clientes-service:8082
      - PROVEEDORES_SERVICE_URL=http://proveedores-service:8083
      - REPORTES_SERVICE_URL=http://reportes-service:8084
      - TRANSACCIONES_SERVICE_URL=http://transacciones-service:8086
      - DOCUMENTOS_SERVICE_URL=http://documentos-service:8087

  # --- Microservicio de Obras ---
  obras-service:
    build:
      context: ./backend1.0/obras-service
      dockerfile: Dockerfile
    container_name: obras_service
    ports:
      - "8081:8081" # Expones el puerto para debug, es opcional
    volumes:
      - ./backend1.0/obras-service/data:/app/data # ¡CRÍTICO! Esto hace que la base de datos sea persistente

  # --- Microservicio de Clientes ---
  clientes-service:
    build:
      context: ./backend1.0/clientes-service
      dockerfile: Dockerfile
    container_name: clientes_service
    ports:
      - "8082:8082"
    volumes:
      - ./backend1.0/clientes-service/data:/app/data

  # --- Microservicio de Proveedores ---
  proveedores-service:
    build:
      context: ./backend1.0/proveedores-service
      dockerfile: Dockerfile
    container_name: proveedores_service
    ports:
      - "8083:8083"
    volumes:
      - ./backend1.0/proveedores-service/data:/app/data

  # --- Microservicio de Transacciones ---
  transacciones-service:
    build:
      context: ./backend1.0/transacciones-service
      dockerfile: Dockerfile
    container_name: transacciones_service
    ports:
      - "8086:8086"
    volumes:
      - ./backend1.0/transacciones-service/data:/app/data

  # --- Microservicio de Reportes ---
  reportes-service:
    build:
      context: ./backend1.0/reportes-service
      dockerfile: Dockerfile
    container_name: reportes_service
    ports:
      - "8084:8084"
    volumes:
      - ./backend1.0/reportes-service/data:/app/data

  # --- Microservicio de Documentos ---
  documentos-service:
    build:
      context: ./backend1.0/documentos-service
      dockerfile: Dockerfile
    container_name: documentos_service
    ports:
      - "8087:8087"
    volumes:
      - ./backend1.0/documentos-service/data:/app/data

