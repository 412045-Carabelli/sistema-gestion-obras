# ==================================
#  Render deployment configuration
# ==================================

server.port=${PORT:8080}
spring.application.name=api-gateway
spring.main.web-application-type=reactive

# ------------------------------
#  Service base URLs
# ------------------------------
obras.service.base-url=${OBRAS_BASE_URL:http://localhost:8081}
clientes.service.base-url=${CLIENTES_BASE_URL:http://localhost:8082}
proveedores.service.base-url=${PROVEEDORES_BASE_URL:http://localhost:8083}
documentos.service.base-url=${DOCUMENTOS_BASE_URL:http://localhost:8087}
transacciones.service.base-url=${TRANSACCIONES_BASE_URL:http://localhost:8086}
reportes.service.base-url=${REPORTES_BASE_URL:http://localhost:8084}

# ------------------------------
#  Gateway routes
# ------------------------------
spring.cloud.gateway.routes[0].id=obras
spring.cloud.gateway.routes[0].uri=${OBRAS_ROUTE_URI:${obras.service.base-url}}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/obras/**

spring.cloud.gateway.routes[1].id=clientes
spring.cloud.gateway.routes[1].uri=${CLIENTES_ROUTE_URI:${clientes.service.base-url}}
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/clientes/**

spring.cloud.gateway.routes[2].id=proveedores
spring.cloud.gateway.routes[2].uri=${PROVEEDORES_ROUTE_URI:${proveedores.service.base-url}}
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/proveedores/**

spring.cloud.gateway.routes[3].id=tipos-proveedor
spring.cloud.gateway.routes[3].uri=${TIPOS_PROVEEDOR_ROUTE_URI:${proveedores.service.base-url}}
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/tipos-proveedor/**

spring.cloud.gateway.routes[4].id=documentos
spring.cloud.gateway.routes[4].uri=${DOCUMENTOS_ROUTE_URI:${documentos.service.base-url}}
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/documentos/**

spring.cloud.gateway.routes[5].id=transacciones
spring.cloud.gateway.routes[5].uri=${TRANSACCIONES_ROUTE_URI:${transacciones.service.base-url}}
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/transacciones/**

spring.cloud.gateway.routes[6].id=reportes
spring.cloud.gateway.routes[6].uri=${REPORTES_ROUTE_URI:${reportes.service.base-url}}
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/reportes/**

# ------------------------------
#  BFF controller endpoints
# ------------------------------
services.obras.base-url=${OBRAS_API_BASE_URL:${obras.service.base-url}}
services.obras.url=${services.obras.base-url}/api/obras
services.obras.costos.url=${services.obras.url}/costos
services.obras.tareas.url=${services.obras.url}/tareas
services.obras.estado_pago.url=${services.obras.url}/estado_pago
services.obras.estado_obra.url=${services.obras.url}/estados

services.clientes.base-url=${CLIENTES_API_BASE_URL:${clientes.service.base-url}}
services.clientes.url=${services.clientes.base-url}/api/clientes

services.proveedores.base-url=${PROVEEDORES_API_BASE_URL:${proveedores.service.base-url}}
services.proveedores.url=${services.proveedores.base-url}/api/proveedores
services.proveedores.tipo.url=${services.proveedores.url}/tipo_proveedor

services.documentos.base-url=${DOCUMENTOS_API_BASE_URL:${documentos.service.base-url}}
services.documentos.url=${services.documentos.base-url}/api/documentos
services.documentos.tipo.url=${services.documentos.base-url}/api/tipo_documentos

services.transacciones.base-url=${TRANSACCIONES_API_BASE_URL:${transacciones.service.base-url}}
services.transacciones.url=${services.transacciones.base-url}/api/transacciones
services.tipo_transacciones.url=${services.transacciones.base-url}/api/tipo_transaccion

services.reportes.base-url=${REPORTES_API_BASE_URL:${reportes.service.base-url}}
services.reportes.url=${services.reportes.base-url}/api/reportes

# ------------------------------
#  CORS configuration
# ------------------------------
spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins[0]=${CORS_ALLOWED_ORIGIN_PRIMARY:https://obras-pablo-pezzini.netlify.app}
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins[1]=${CORS_ALLOWED_ORIGIN_SECONDARY:http://localhost:4200}
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowCredentials=true

# ------------------------------
#  Memory limits
# ------------------------------
spring.codec.max-in-memory-size=10MB
spring.webflux.multipart.max-in-memory-size=10MB

# ------------------------------
#  Debug
# ------------------------------
debug=${DEBUG_ENABLED:true}
