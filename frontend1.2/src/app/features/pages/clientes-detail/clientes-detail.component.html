<p-toast></p-toast>

@if (loading) {
  <div class="flex justify-center items-center min-h-[60vh]">
    <p-progressSpinner styleClass="w-16 h-16" strokeWidth="4" animationDuration=".8s"></p-progressSpinner>
  </div>
} @else {
  @defer (when cliente) {
    <div class="p-6 space-y-6 mx-auto bg-white rounded-xl shadow-sm">

      <!-- ===================== HEADER ===================== -->
      <div class="flex justify-between items-start flex-wrap gap-3">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">{{ cliente.nombre }}</h1>
          <p class="text-gray-500 text-sm mt-1">{{ cliente.contacto || 'Sin contacto' }}</p>
        </div>

        <div class="flex items-center gap-2">
          <p-button
            icon="pi pi-pencil"
            styleClass="p-button-rounded p-button-text"
            pTooltip="Editar Cliente"
            tooltipPosition="top"
            (onClick)="editarCliente()">
          </p-button>

          <p-button
            [icon]="cliente.activo ? 'pi pi-ban' : 'pi pi-check'"
            [severity]="cliente.activo ? 'danger' : 'success'"
            styleClass="p-button-rounded p-button-text"
            [pTooltip]="cliente.activo ? 'Desactivar cliente' : 'Activar cliente'"
            tooltipPosition="top"
            (onClick)="toggleActivo()">
          </p-button>
        </div>
      </div>

      <!-- ===================== INFO GENERAL ===================== -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <p><strong>CUIT:</strong> {{ cliente.cuit || 'â€”' }}</p>
          <p><strong>Email:</strong> {{ cliente.email || 'â€”' }}</p>
          <p><strong>TelÃ©fono:</strong> {{ cliente.telefono || 'â€”' }}</p>
        </div>

        <div class="space-y-2">
          <p>
            <strong>Estado: </strong>
            <p-tag [value]="cliente.activo ? 'Activo' : 'Inactivo'"
                   [severity]="getActivoSeverity(cliente.activo!)"></p-tag>
          </p>
        </div>
      </div>

      <!-- ===================== TABS ===================== -->
      <p-tabs value="0">
        <p-tablist>
          <p-tab value="0">Obras</p-tab>
          <p-tab value="1">Documentos</p-tab>
        </p-tablist>

        <p-tabpanels>
          <p-tabpanel value="0">
            <p-table [value]="obras" [tableStyle]="{ 'min-width': '100%' }" class="w-full">
              <ng-template pTemplate="header">
                <tr>
                  <th class="px-3 py-2 text-left">Nombre</th>
                  <th class="px-3 py-2 text-left">DirecciÃ³n</th>
                  <th class="px-3 py-2 text-left">Estado</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-obra>
                <tr class="hover:bg-gray-100 cursor-pointer" (click)="verObra(obra)">
                  <td class="px-3 py-2">{{ obra.nombre }}</td>
                  <td class="px-3 py-2">{{ obra.direccion || 'â€”' }}</td>
                  <td class="px-3 py-2">{{ obra.obra_estado?.nombre || 'â€”' }}</td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="1">
            <h1>Documentos del cliente</h1>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>
  } @placeholder {
    <!-- ðŸ¦´ Skeleton Placeholder Cliente -->
    <div class="p-6 space-y-6 mx-auto bg-white rounded-xl shadow-sm animate-pulse">
      <div class="flex justify-between items-start flex-wrap gap-3">
        <div class="space-y-2 w-1/2">
          <div class="h-6 bg-gray-200 rounded w-2/3"></div>
          <div class="h-4 bg-gray-200 rounded w-1/3"></div>
        </div>
        <div class="h-10 w-20 bg-gray-200 rounded"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <div class="h-4 bg-gray-200 rounded w-2/3"></div>
          <div class="h-4 bg-gray-200 rounded w-1/2"></div>
          <div class="h-4 bg-gray-200 rounded w-1/3"></div>
        </div>
        <div class="space-y-2">
          <div class="h-4 bg-gray-200 rounded w-1/2"></div>
        </div>
      </div>

      <div class="space-y-3">
        <div class="h-6 bg-gray-200 rounded w-1/4"></div>
        <div class="h-4 bg-gray-200 rounded w-full"></div>
        <div class="h-4 bg-gray-200 rounded w-5/6"></div>
        <div class="h-4 bg-gray-200 rounded w-2/3"></div>
      </div>
    </div>
  }
}
