@defer (when datosCargados) {
  <div class="flex flex-col gap-4">

    <!-- Filtros -->
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
        <!-- Buscar -->
        <div class="md:col-span-8">
          <p-iconfield iconPosition="left" styleClass="w-full">
            <p-inputicon styleClass="pi pi-search"/>
            <input
              (input)="applyFilter()"
              [(ngModel)]="searchValue"
              class="w-full"
              pInputText
              placeholder="Buscar por nombre, direcci√≥n o cliente"
              type="text"/>
          </p-iconfield>
        </div>

        <!-- Estado -->
        <div class="md:col-span-4">
          <p-select
            (onChange)="onEstadoChange()"
            [(ngModel)]="estadoFiltro"
            [options]="estadosOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por estado"
            styleClass="w-full h-full flex items-center">
            <ng-template let-option pTemplate="selectedItem">
              <div class="flex items-center gap-2">
                <i class="pi pi-filter text-sm"></i>
                <span>{{ option?.label || 'Todos' }}</span>
              </div>
            </ng-template>
          </p-select>
        </div>
      </div>
    </div>

    <!-- Tabla -->
    <div class="flex justify-end">
      <p-button
        icon="pi pi-file-excel"
        label="Exportar listado"
        severity="success"
        (onClick)="exportarListado()"
        pTooltip="Descarga las obras filtradas en Excel"
      ></p-button>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
      <p-table
        [paginator]="true"
        [paginatorDropdownAppendTo]="'body'"
        [rowHover]="true"
        [rowsPerPageOptions]="[10, 25, 50]"
        [rows]="10"
        [showCurrentPageReport]="true"
        [value]="obrasFiltradas"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} obras"
        styleClass="p-datatable-sm">

        <ng-template pTemplate="header">
          <tr>
            <th class="text-left font-semibold">Obra</th>
            <th class="text-left font-semibold">Cliente</th>
            <th class="text-left font-semibold">Estado</th>
            <th class="text-left font-semibold">Per√≠odo</th>
            <th class="text-right font-semibold">Presupuesto</th>
          </tr>
        </ng-template>

        <ng-template let-obra pTemplate="body">
          <tr (click)="onRowClick(obra)" class="cursor-pointer hover:bg-gray-50 transition-colors">
            <td>
              <div class="flex flex-col gap-1">
                <span class="font-semibold text-gray-900 text-sm">{{ obra.nombre }}</span>
                <span class="text-xs text-gray-500">{{ obra.direccion }}</span>
              </div>
            </td>
            <td class="text-gray-700">{{ obra.cliente.nombre }}</td>
            <td>
              <p-tag [severity]="getEstadoSeverity(obra.id_estado_obra)"
                     [value]="obra.obra_estado.nombre"
                     styleClass="text-xs"></p-tag>
            </td>
            <td>
              <div *ngIf="obra.fecha_inicio; else sinFechas" class="flex flex-col gap-1 text-xs text-gray-600">
                <span>Desde: {{ obra.fecha_inicio | date:'dd/MM/yy' }}</span>
                <span *ngIf="obra.fecha_fin">Hasta: {{ obra.fecha_fin | date:'dd/MM/yy' }}</span>
              </div>
              <ng-template #sinFechas>
                <span class="text-gray-400 text-sm">‚Äî</span>
              </ng-template>
            </td>
            <td class="text-right font-medium text-gray-900">
              {{ obra.presupuesto | currency:'ARS':'symbol-narrow':'1.0-0' }}
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="text-center py-12" colspan="7">
              <div class="flex flex-col items-center justify-center gap-3 text-gray-400">
                <i class="pi pi-inbox text-5xl"></i>
                <p class="text-lg font-medium">No se encontraron obras</p>
                <p class="text-sm">Intenta ajustar los filtros de b√∫squeda</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
} @placeholder {
  <!-- ü¶¥ Skeleton tabla -->
  <div class="flex flex-col gap-4 animate-pulse">
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
        <div class="md:col-span-8 h-10 bg-gray-200 rounded"></div>
        <div class="md:col-span-4 h-10 bg-gray-200 rounded"></div>
      </div>
    </div>

    <div class="bg-white rounded-lg border border-gray-200 p-4">
      <div class="space-y-3">
        <div class="h-5 bg-gray-200 rounded w-full"></div>
        <div class="h-5 bg-gray-200 rounded w-11/12"></div>
        <div class="h-5 bg-gray-200 rounded w-10/12"></div>
        <div class="h-5 bg-gray-200 rounded w-9/12"></div>
        <div class="h-5 bg-gray-200 rounded w-8/12"></div>
      </div>
    </div>
  </div>
}
