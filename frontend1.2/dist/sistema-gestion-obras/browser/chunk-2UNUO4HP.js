import{a as $}from"./chunk-3IQLNM73.js";import{a as D,b as B}from"./chunk-KZ3QJ2LT.js";import{i as A,l as V}from"./chunk-WA2J6DLI.js";import"./chunk-XZVY7D3K.js";import{d as P,i as j}from"./chunk-BDBZ2QWO.js";import{a as L}from"./chunk-E4WRTJ72.js";import"./chunk-X5MSVAUN.js";import{a as F,b as R}from"./chunk-SVAZSSDV.js";import"./chunk-BBQRPO7P.js";import{g as N}from"./chunk-V6H4TXMQ.js";import"./chunk-VHDVROXF.js";import"./chunk-N52SNE3S.js";import"./chunk-F2X3VGZZ.js";import"./chunk-IZVSUXNV.js";import"./chunk-LSHC46HD.js";import"./chunk-4BJQ3EOG.js";import"./chunk-MLMYHGGX.js";import"./chunk-42DWQLJE.js";import"./chunk-XQ2VYUTW.js";import"./chunk-MX3PZFJO.js";import"./chunk-LXJ5KELJ.js";import"./chunk-CV2ZWZQE.js";import{I as k,r as M}from"./chunk-G4GGURKU.js";import"./chunk-5GYOOLE2.js";import{Bb as y,Gb as x,Hb as c,Ma as l,Ra as d,Rb as r,Sb as u,Tb as E,Ya as C,Zb as O,a as g,aa as f,b as S,ba as b,cb as _,hc as w,ic as I,lb as v,qb as h,vb as i,wb as t,xb as p,z as T}from"./chunk-HE3ZW6WA.js";var J=()=>({"min-width":"60rem"});function z(a,n){a&1&&(i(0,"div",7),p(1,"p-progressSpinner"),t())}function H(a,n){a&1&&(i(0,"tr")(1,"th"),r(2,"Nombre"),t(),i(3,"th"),r(4,"Estado"),t(),i(5,"th"),r(6,"Obra"),t(),i(7,"th"),r(8,"Proveedor"),t(),i(9,"th"),r(10,"Acciones"),t()())}function K(a,n){if(a&1){let e=y();i(0,"tr")(1,"td")(2,"div",11),r(3),t(),i(4,"div",12),r(5),t()(),i(6,"td"),p(7,"p-tag",13),w(8,"estadoFormat"),t(),i(9,"td")(10,"button",14),x("click",function(){let o=f(e).$implicit,s=c(2);return b(s.irAObra(o.id_obra))}),r(11),t()(),i(12,"td"),r(13),t(),i(14,"td")(15,"button",15),x("click",function(){let o=f(e).$implicit,s=c(2);return b(s.irAObra(o.id_obra))}),r(16,"Ver obra"),t()()()}if(a&2){let e=n.$implicit;l(3),u(e.nombre),l(2),u(e.descripcion||"Sin descripci\xF3n"),l(2),v("value",I(8,6,e.estado_tarea))("severity",e.estado_tarea==="COMPLETADA"?"success":e.estado_tarea==="EN_PROGRESO"?"info":"warning"),l(4),E(" ",e.obraNombre," "),l(2),u((e.proveedor==null?null:e.proveedor.nombre)||"Sin proveedor")}}function Q(a,n){if(a&1&&(i(0,"p-table",8),_(1,H,11,0,"ng-template",9)(2,K,17,8,"ng-template",10),t()),a&2){let e=c();v("value",e.tareas)("tableStyle",O(2,J))}}var q=class a{constructor(n,e,m){this.tareasService=n;this.obrasService=e;this.router=m}loading=!0;tareas=[];ngOnInit(){this.cargarTareas()}cargarTareas(){this.loading=!0,this.obrasService.getObras().subscribe({next:n=>{let e=new Map(n.map(o=>[o.id,o.nombre])),m=n.map(o=>this.tareasService.getTareasByObra(o.id));if(!m.length){this.loading=!1;return}T(m).subscribe({next:o=>{this.tareas=o.flat().map(s=>S(g({},s),{obraNombre:e.get(s.id_obra)||"Sin referencia"})).sort((s,G)=>(G.id||0)-(s.id||0)),this.loading=!1},error:()=>this.loading=!1})},error:()=>this.loading=!1})}irAObra(n){n&&this.router.navigate(["/obras",n])}static \u0275fac=function(e){return new(e||a)(d(L),d(j),d(P))};static \u0275cmp=C({type:a,selectors:[["app-tareas"]],decls:13,vars:1,consts:[[1,"p-6","space-y-4"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"bg-white","rounded-lg","shadow"],[1,"p-4","border-b","flex","items-center","gap-2","text-sm","text-gray-600"],[1,"pi","pi-info-circle","text-indigo-600"],[1,"p-6","flex","justify-center"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[1,"font-semibold","text-gray-800"],[1,"text-xs","text-gray-500"],[3,"value","severity"],[1,"text-indigo-600","hover:underline",3,"click"],[1,"text-sm","text-indigo-600","hover:underline",3,"click"]],template:function(e,m){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),r(4,"Todas las tareas"),t(),i(5,"p",3),r(6,"Listado consolidado por obra y proveedor"),t()()(),i(7,"div",4)(8,"div",5),p(9,"i",6),r(10," Incluye tareas en cualquier estado y muestra la referencia de obra. "),t(),_(11,z,2,0,"div",7)(12,Q,3,3,"p-table",8),t()()),e&2&&(l(11),h(m.loading?11:12))},dependencies:[M,V,A,k,B,D,R,F,N,$],styles:["[_nghost-%COMP%]{display:block}button[_ngcontent-%COMP%]{transition:color .2s ease}"]})};export{q as TareasComponent};
