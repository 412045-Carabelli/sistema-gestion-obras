import{a as K}from"./chunk-YL45AVMU.js";import{d as U,i as Y}from"./chunk-BDBZ2QWO.js";import{a as X}from"./chunk-E4WRTJ72.js";import{a as Q}from"./chunk-6QB4PU6K.js";import"./chunk-X5MSVAUN.js";import{a as q,b as H}from"./chunk-SVAZSSDV.js";import{b as L}from"./chunk-WXQODJCJ.js";import"./chunk-BBQRPO7P.js";import"./chunk-N52SNE3S.js";import"./chunk-F2X3VGZZ.js";import"./chunk-42DWQLJE.js";import"./chunk-LXJ5KELJ.js";import{E as j,k as $,p as Z,q as G,r as J}from"./chunk-G4GGURKU.js";import"./chunk-5GYOOLE2.js";import{Bb as h,Gb as _,Hb as m,Ma as a,Ra as f,Rb as r,Sb as g,Tb as v,Ub as N,Ya as M,Yb as z,Zb as R,a as P,aa as c,b as A,ba as p,cb as b,hc as C,ib as D,ic as B,jb as T,jc as W,kc as k,lb as w,qb as O,sb as I,tb as E,ub as y,vb as e,wb as i,xb as l,z as F}from"./chunk-HE3ZW6WA.js";var re=()=>[G],oe=()=>[import("./chunk-AHKCA2EW.js").then(n=>n.Button),import("./chunk-DAQWPOLO.js").then(n=>n.EstadoFormatPipe)],ae=()=>[$,G,Z,import("./chunk-AHKCA2EW.js").then(n=>n.Button)],le=()=>[1,2,3,4,5,6],te=()=>[1,2,3,4,5],ie=(n,o)=>o.id;function de(n,o){n&1&&(e(0,"div",9),l(1,"p-progressSpinner",10),i())}function se(n,o){if(n&1){let t=h();e(0,"div",29)(1,"div",30),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado())}),e(2,"div",31)(3,"div",32),l(4,"i",33),i(),e(5,"span",34),r(6,"Obras Totales"),i()(),e(7,"div",35),r(8),i(),e(9,"div",36),r(10,"Registradas en el sistema"),i()(),e(11,"div",37),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado("COTIZADA"))}),e(12,"div",31)(13,"div",38),l(14,"i",39),i(),e(15,"span",34),r(16,"Cotizadas"),i()(),e(17,"div",35),r(18),i(),e(19,"div",36),r(20,"En etapa de cotizaci\xF3n"),i()(),e(21,"div",40),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado("PERDIDA"))}),e(22,"div",31)(23,"div",41),l(24,"i",42),i(),e(25,"span",34),r(26,"Perdidas"),i()(),e(27,"div",35),r(28),i(),e(29,"div",36),r(30,"Cotizaciones no adjudicadas"),i()(),e(31,"div",43),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado("ADJUDICADA"))}),e(32,"div",31)(33,"div",44),l(34,"i",45),i(),e(35,"span",34),r(36,"Adjudicadas"),i()(),e(37,"div",35),r(38),i(),e(39,"div",36),r(40,"Ganadas"),i()(),e(41,"div",46),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado("EN_PROGRESO"))}),e(42,"div",31)(43,"div",47),l(44,"i",48),i(),e(45,"span",34),r(46,"Activas"),i()(),e(47,"div",35),r(48),i(),e(49,"div",36),r(50,"En ejecuci\xF3n"),i()(),e(51,"div",49),_("click",function(){c(t);let d=m(2);return p(d.navigateToObrasEstado("FINALIZADA"))}),e(52,"div",31)(53,"div",50),l(54,"i",51),i(),e(55,"span",34),r(56,"Finalizadas"),i()(),e(57,"div",35),r(58),i(),e(59,"div",36),r(60,"Cerradas"),i()()()}if(n&2){let t=m(2);a(8),g(t.conteoObras.total),a(10),g(t.conteoObras.cotizadas),a(10),g(t.conteoObras.perdidas),a(10),g(t.conteoObras.adjudicadas),a(10),g(t.conteoObras.activas),a(10),g(t.conteoObras.finalizadas)}}function me(n,o){n&1&&(e(0,"div",52)(1,"div",31),l(2,"div",53)(3,"div",54),i(),l(4,"div",55)(5,"div",56),i())}function ce(n,o){n&1&&(e(0,"div",29),E(1,me,6,0,"div",52,I),i()),n&2&&(a(),y(R(0,le)))}function pe(n,o){if(n&1&&(e(0,"div",11)(1,"h2",12),l(2,"i",57),r(3," Flujo de Caja Reciente "),i(),e(4,"div",58)(5,"div",59)(6,"div",60),l(7,"i",61),e(8,"span",62),r(9,"Ingresos"),i()(),e(10,"div",63),r(11),C(12,"currency"),i()(),e(13,"div",64)(14,"div",60),l(15,"i",65),e(16,"span",62),r(17,"Egresos"),i()(),e(18,"div",66),r(19),C(20,"currency"),i()(),e(21,"div",67)(22,"div",60),l(23,"i",57),e(24,"span",62),r(25,"Saldo"),i()(),e(26,"div",68),r(27),C(28,"currency"),i()()()()),n&2){let t=m(2);a(11),v(" ",k(12,3,t.flujoCaja.totalIngresos,"ARS","symbol-narrow","1.0-0")," "),a(8),v(" ",k(20,8,t.flujoCaja.totalEgresos,"ARS","symbol-narrow","1.0-0")," "),a(8),v(" ",k(28,13,t.flujoCaja.saldoFinal,"ARS","symbol-narrow","1.0-0")," ")}}function _e(n,o){n&1&&(e(0,"div",52),l(1,"div",69),e(2,"div",70),l(3,"div",71)(4,"div",71)(5,"div",71),i()())}function xe(n,o){if(n&1){let t=h();e(0,"div",79),_("click",function(){let d=c(t).$implicit,x=m(4);return p(x.navigateTo("/obras/"+d.id_obra))}),e(1,"div",80),l(2,"i",81),i(),e(3,"div",82)(4,"p",83),r(5),i(),e(6,"p",84),r(7),i(),e(8,"p",85),r(9),i()(),e(10,"span",86),r(11),C(12,"estadoFormat"),i()()}if(n&2){let t=o.$implicit;a(5),g(t.nombre),a(2),g(t.descripcion||"Sin descripci\xF3n"),a(2),v("Obra ",t.obraNombre||"Sin referencia",""),a(2),v(" ",B(12,4,t.estado_tarea)," ")}}function ge(n,o){if(n&1&&(e(0,"div",76),E(1,xe,13,6,"div",78,ie),i()),n&2){let t=m(3);a(),y(t.tareasRecientes.slice(0,5))}}function be(n,o){n&1&&(e(0,"div",77),l(1,"i",87),e(2,"p",88),r(3,"No hay tareas recientes"),i()())}function ve(n,o){if(n&1){let t=h();e(0,"div",11)(1,"div",72)(2,"h2",73),l(3,"i",74),r(4," Tareas Recientes "),i(),e(5,"p-button",75),_("onClick",function(){c(t);let d=m(2);return p(d.navigateTo("/tareas"))}),i()(),b(6,ge,3,0,"div",76)(7,be,4,0,"div",77),i()}if(n&2){let t=m(2);a(5),w("text",!0),a(),O(t.tareasRecientes.length>0?6:7)}}function ue(n,o){n&1&&l(0,"div",90)}function fe(n,o){n&1&&(e(0,"div",52),l(1,"div",89),e(2,"div",76),E(3,ue,1,0,"div",90,I),i()()),n&2&&(a(3),y(R(0,te)))}function he(n,o){if(n&1){let t=h();e(0,"div",79),_("click",function(){let d=c(t).$implicit,x=m(4);return p(x.navigateTo("/obras/"+d.obraId))}),e(1,"div",93),l(2,"i",94),i(),e(3,"div",82)(4,"p",95)(5,"span"),r(6),i(),e(7,"span",96),l(8,"i",97),r(9),i()(),e(10,"p",98),l(11,"i",99),e(12,"span"),r(13),C(14,"date"),i()(),e(15,"p",100),r(16),i()(),e(17,"span",101),r(18),C(19,"currency"),i()()}if(n&2){let t=o.$implicit;a(),w("ngClass",(t.tipo_movimiento||t.tipo)==="INGRESO"?"bg-green-100":(t.tipo_movimiento||t.tipo)==="EGRESO"?"bg-red-100":"bg-indigo-100"),a(),w("ngClass",(t.tipo_movimiento||t.tipo)==="INGRESO"?"pi-arrow-up text-green-600":(t.tipo_movimiento||t.tipo)==="EGRESO"?"pi-arrow-down text-red-600":"pi-file text-indigo-600"),a(4),g(t.formaPago),a(3),v(" ",(t.tipo_movimiento||t.tipo)==="INGRESO"?"Cobro":(t.tipo_movimiento||t.tipo)==="EGRESO"?"Pago":t.tipo_movimiento||t.tipo||"Movimiento"," "),a(4),g(W(14,9,t.fecha,"dd/MM/yyyy")),a(3),v("Obra ",t.obraNombre,""),a(),w("ngClass",(t.tipo_movimiento||t.tipo)==="COBRO"?"text-green-600":(t.tipo_movimiento||t.tipo)==="PAGO"?"text-red-600":"text-indigo-600"),a(),N(" ",(t.tipo_movimiento||t.tipo)==="COBRO"?"+":"-"," ",k(19,12,t.monto,"ARS","symbol-narrow","1.0-0")," ")}}function Ce(n,o){if(n&1&&(e(0,"div",76),E(1,he,20,17,"div",78,ie),i()),n&2){let t=m(3);a(),y(t.movimientosRecientes.slice(0,5))}}function Se(n,o){n&1&&(e(0,"div",77),l(1,"i",87),e(2,"p",88),r(3,"No hay movimientos recientes"),i()())}function we(n,o){if(n&1){let t=h();e(0,"div",11)(1,"div",72)(2,"h2",73),l(3,"i",91),r(4," Movimientos Recientes "),i(),e(5,"p-button",92),_("onClick",function(){c(t);let d=m(2);return p(d.navigateTo("/reportes"))}),i()(),b(6,Ce,3,0,"div",76)(7,Se,4,0,"div",77),i()}if(n&2){let t=m(2);a(5),w("text",!0),a(),O(t.movimientosRecientes.length>0?6:7)}}function Ee(n,o){n&1&&l(0,"div",90)}function ye(n,o){n&1&&(e(0,"div",52),l(1,"div",89),e(2,"div",76),E(3,Ee,1,0,"div",90,I),i()()),n&2&&(a(3),y(R(0,te)))}function De(n,o){if(n&1){let t=h();e(0,"div",11)(1,"h2",12),l(2,"i",13),r(3," Accesos R\xE1pidos "),i(),e(4,"div",14)(5,"button",15),_("click",function(){c(t);let d=m();return p(d.navigateTo("/obras"))}),e(6,"div",16),l(7,"i",17),i(),e(8,"span",18),r(9,"Obras"),i()(),e(10,"button",19),_("click",function(){c(t);let d=m();return p(d.navigateTo("/proveedores"))}),e(11,"div",20),l(12,"i",21),i(),e(13,"span",18),r(14,"Proveedores"),i()(),e(15,"button",22),_("click",function(){c(t);let d=m();return p(d.navigateTo("/clientes"))}),e(16,"div",23),l(17,"i",24),i(),e(18,"span",18),r(19,"Clientes"),i()(),e(20,"button",25),_("click",function(){c(t);let d=m();return p(d.navigateTo("/reportes"))}),e(21,"div",26),l(22,"i",27),i(),e(23,"span",18),r(24,"Reportes"),i()()()(),b(25,se,61,6)(26,ce,3,1),D(27,25,null,null,26),b(29,pe,29,18)(30,_e,6,0),D(31,29,re,null,30),e(33,"div",28),b(34,ve,8,2)(35,fe,5,1),D(36,34,oe,null,35),b(38,we,8,2)(39,ye,5,1),D(40,38,ae,null,39),i()}if(n&2){let t=m();a(27),T(t.resumenGeneral),a(4),T(t.flujoCaja),a(5),T(t.tareasRecientes),a(4),T(t.movimientosRecientes)}}var ee=class n{constructor(o,t,s,d,x,S){this.router=o;this.reportesService=t;this.tareasService=s;this.transaccionesService=d;this.obrasService=x;this.messageService=S}loadingGeneral=!0;resumenGeneral;flujoCaja;tareasRecientes=[];movimientosRecientes=[];conteoObras={total:0,cotizadas:0,perdidas:0,adjudicadas:0,activas:0,finalizadas:0};ngOnInit(){this.cargarDashboard()}cargarDashboard(){this.loadingGeneral=!0,F({resumen:this.reportesService.getResumenGeneral(),flujo:this.reportesService.getFlujoCaja(),obras:this.obrasService.getObras()}).subscribe({next:({resumen:o,flujo:t,obras:s})=>{this.resumenGeneral=o,this.flujoCaja=t,this.conteoObras=this.calcularConteosObras(s);let d=s.slice(0,3),x=d.map(S=>this.tareasService.getTareasByObra(S.id));x.length>0&&F(x).subscribe({next:S=>{let V=new Map(d.map(u=>[u.id,u.nombre]));this.tareasRecientes=[].concat(...S).map(u=>A(P({},u),{obraNombre:V.get(u.id_obra)||"Obra sin nombre"})).sort((u,ne)=>(ne.id||0)-(u.id||0))}}),this.movimientosRecientes=(t.movimientos||[]).sort((S,V)=>new Date(V.fecha).getTime()-new Date(S.fecha).getTime()).slice(0,10),this.loadingGeneral=!1},error:o=>{console.error("Error cargando dashboard:",o),this.loadingGeneral=!1,this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo cargar la informaci\xF3n del dashboard"})}})}navigateTo(o){this.router.navigate([o])}navigateToObrasEstado(o){o?this.router.navigate(["/obras"],{queryParams:{estado:o}}):this.router.navigate(["/obras"])}calcularConteosObras(o){let t=s=>(s||"").toUpperCase();return o.reduce((s,d)=>{let x=t(d.obra_estado);return s.total+=1,x.includes("COTIZ")&&(s.cotizadas+=1),x.includes("PERDID")&&(s.perdidas+=1),x.includes("ADJUDIC")&&(s.adjudicadas+=1),x.includes("ACTIV")&&(s.activas+=1),x.includes("FINALIZ")&&(s.finalizadas+=1),s},P({},this.conteoObras))}static \u0275fac=function(t){return new(t||n)(f(U),f(K),f(X),f(Q),f(Y),f(j))};static \u0275cmp=M({type:n,selectors:[["app-dashboard"]],features:[z([j])],decls:13,vars:1,consts:[["position","bottom-right"],[1,"relative","bg-gradient-to-r","from-indigo-600","to-purple-800","shadow-lg","p-8","text-white","overflow-hidden"],[1,"absolute","inset-0","opacity-10"],[1,"absolute","-right-10","-top-10","w-40","h-40","bg-white","rounded-full"],[1,"absolute","-left-10","-bottom-10","w-32","h-32","bg-white","rounded-full"],[1,"relative","z-10"],[1,"text-3xl","font-bold","mb-2"],[1,"text-indigo-100"],[1,"p-8","space-y-8","max-w-full","mx-auto"],[1,"flex","justify-center","items-center","py-12"],["strokeWidth","4","styleClass","w-16 h-16"],[1,"bg-white","rounded-xl","shadow-md","p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-5","flex","items-center","gap-2","pb-3","border-b","border-gray-200"],[1,"pi","pi-bolt","text-indigo-600"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"cursor-pointer","flex","flex-col","items-center","gap-3","p-4","rounded-lg","bg-gradient-to-br","from-blue-50","to-blue-100","hover:from-blue-100","hover:to-blue-200","transition-all","border","border-blue-200","hover:shadow-md",3,"click"],[1,"w-12","h-12","bg-blue-500","rounded-full","flex","items-center","justify-center"],[1,"pi","pi-building","text-white","text-xl"],[1,"text-sm","font-semibold","text-gray-700","text-center"],[1,"cursor-pointer","flex","flex-col","items-center","gap-3","p-4","rounded-lg","bg-gradient-to-br","from-purple-50","to-purple-100","hover:from-purple-100","hover:to-purple-200","transition-all","border","border-purple-200","hover:shadow-md",3,"click"],[1,"w-12","h-12","bg-purple-500","rounded-full","flex","items-center","justify-center"],[1,"pi","pi-truck","text-white","text-xl"],[1,"cursor-pointer","flex","flex-col","items-center","gap-3","p-4","rounded-lg","bg-gradient-to-br","from-green-50","to-green-100","hover:from-green-100","hover:to-green-200","transition-all","border","border-green-200","hover:shadow-md",3,"click"],[1,"w-12","h-12","bg-green-500","rounded-full","flex","items-center","justify-center"],[1,"pi","pi-users","text-white","text-xl"],[1,"cursor-pointer","flex","flex-col","items-center","gap-3","p-4","rounded-lg","bg-gradient-to-br","from-orange-50","to-orange-100","hover:from-orange-100","hover:to-orange-200","transition-all","border","border-orange-200","hover:shadow-md",3,"click"],[1,"w-12","h-12","bg-orange-500","rounded-full","flex","items-center","justify-center"],[1,"pi","pi-chart-bar","text-white","text-xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"grid","gap-6","md:grid-cols-2","xl:grid-cols-3"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-blue-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-12","h-12","bg-blue-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-building","text-blue-600","text-xl"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-amber-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"w-12","h-12","bg-amber-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-percentage","text-amber-600","text-xl"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-red-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"w-12","h-12","bg-red-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-times-circle","text-red-600","text-xl"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-emerald-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"w-12","h-12","bg-emerald-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-check-circle","text-emerald-600","text-xl"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-indigo-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"w-12","h-12","bg-indigo-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-play","text-indigo-600","text-xl"],[1,"bg-white","rounded-xl","shadow-md","p-6","border-l-4","border-gray-500","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"w-12","h-12","bg-gray-100","rounded-lg","flex","items-center","justify-center"],[1,"pi","pi-flag","text-gray-600","text-xl"],[1,"bg-white","rounded-xl","shadow-md","p-6","animate-pulse"],[1,"w-12","h-12","bg-gray-200","rounded-lg"],[1,"h-4","bg-gray-200","rounded","w-20"],[1,"h-8","bg-gray-200","rounded","w-16","mb-2"],[1,"h-3","bg-gray-200","rounded","w-24"],[1,"pi","pi-wallet","text-indigo-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-green-50","rounded-lg","p-4","border","border-green-200"],[1,"flex","items-center","gap-2","mb-2"],[1,"pi","pi-arrow-up","text-green-600"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"bg-red-50","rounded-lg","p-4","border","border-red-200"],[1,"pi","pi-arrow-down","text-red-600"],[1,"text-2xl","font-bold","text-red-600"],[1,"bg-indigo-50","rounded-lg","p-4","border","border-indigo-200"],[1,"text-2xl","font-bold","text-indigo-600"],[1,"h-6","bg-gray-200","rounded","w-1/4","mb-5"],[1,"grid","grid-cols-3","gap-4"],[1,"h-24","bg-gray-100","rounded-lg"],[1,"flex","items-center","justify-between","mb-5","pb-3","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"pi","pi-list-check","text-indigo-600"],["label","Ver todas","icon","pi pi-arrow-right","size","small",3,"onClick","text"],[1,"space-y-3"],[1,"text-center","py-8","text-gray-400"],[1,"flex","items-center","gap-3","p-3","bg-gray-50","rounded-lg","hover:bg-gray-100","transition-colors","cursor-pointer"],[1,"flex","items-center","gap-3","p-3","bg-gray-50","rounded-lg","hover:bg-gray-100","transition-colors","cursor-pointer",3,"click"],[1,"w-10","h-10","bg-blue-100","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],[1,"pi","pi-check-circle","text-blue-600"],[1,"flex-1","min-w-0"],[1,"text-sm","font-semibold","text-gray-900","truncate"],[1,"text-xs","text-gray-500"],[1,"text-xs","text-indigo-600","font-semibold","mt-1"],[1,"px-2","py-1","text-xs","font-semibold","rounded-full","bg-blue-100","text-blue-800"],[1,"pi","pi-inbox","text-4xl","mb-2"],[1,"text-sm"],[1,"h-6","bg-gray-200","rounded","w-1/3","mb-5"],[1,"h-16","bg-gray-100","rounded-lg"],[1,"pi","pi-arrow-right-arrow-left","text-indigo-600"],["label","Ver todos","icon","pi pi-arrow-right","size","small",3,"onClick","text"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","flex-shrink-0",3,"ngClass"],[1,"pi","text-lg",3,"ngClass"],[1,"text-sm","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"inline-flex","items-center","gap-1","text-[11px]","font-semibold","px-2","py-1","rounded-full","bg-gray-100","text-gray-700"],[1,"pi","pi-tag","text-xs"],[1,"text-xs","text-gray-500","flex","items-center","gap-2"],[1,"pi","pi-calendar","text-gray-400"],[1,"text-xs","text-indigo-700","font-semibold","mt-1"],[1,"text-sm","font-bold",3,"ngClass"]],template:function(t,s){t&1&&(l(0,"p-toast",0),e(1,"div",1)(2,"div",2),l(3,"div",3)(4,"div",4),i(),e(5,"div",5)(6,"h1",6),r(7,"Dashboard General"),i(),e(8,"p",7),r(9,"Vista general del sistema - Resumen de actividades"),i()()(),e(10,"div",8),b(11,de,2,0,"div",9)(12,De,42,4),i()),t&2&&(a(11),O(s.loadingGeneral?11:12))},dependencies:[J,L,H,q],styles:["[_nghost-%COMP%]{display:block;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.bg-white[_ngcontent-%COMP%]{transition:all .3s ease}"]})};export{ee as DashboardComponent};
