import{b as se,c as de}from"./chunk-XV6SL7QC.js";import{a as ce,b as me}from"./chunk-KZ3QJ2LT.js";import{a as re}from"./chunk-XAMQR3BY.js";import{a as le}from"./chunk-R4Q2BO3D.js";import"./chunk-YHK2U7VT.js";import{a as Q}from"./chunk-4BI7NTQR.js";import{d as Z,e as $,f as ee,h as te,i as oe,l as ne}from"./chunk-WA2J6DLI.js";import"./chunk-XZVY7D3K.js";import{a as pe}from"./chunk-6QB4PU6K.js";import"./chunk-X5MSVAUN.js";import{b as ae}from"./chunk-WXQODJCJ.js";import"./chunk-BBQRPO7P.js";import{f as X,g as Y}from"./chunk-V6H4TXMQ.js";import{l as ie}from"./chunk-VHDVROXF.js";import"./chunk-N52SNE3S.js";import"./chunk-F2X3VGZZ.js";import{b as j,e as U,h as q,o as z,s as H}from"./chunk-IZVSUXNV.js";import"./chunk-LSHC46HD.js";import"./chunk-4BJQ3EOG.js";import{c as J,d as K}from"./chunk-MLMYHGGX.js";import"./chunk-42DWQLJE.js";import"./chunk-XQ2VYUTW.js";import"./chunk-MX3PZFJO.js";import"./chunk-LXJ5KELJ.js";import"./chunk-CV2ZWZQE.js";import{A as w,E as P,I as G,k as D,p as W,q as F,r as k}from"./chunk-G4GGURKU.js";import"./chunk-5GYOOLE2.js";import{$b as L,Bb as T,Gb as f,Hb as m,Ma as l,Ra as S,Rb as s,Sb as C,Tb as V,Ub as A,Vb as p,Wb as u,Xb as _,Ya as B,Yb as N,Zb as I,a as y,aa as v,b as E,ba as g,cb as x,hc as b,jc as h,lb as c,qb as O,vb as n,wb as a,xb as M}from"./chunk-HE3ZW6WA.js";var _e=()=>({label:"Proveedor",value:"PROVEEDOR"}),ve=()=>({label:"Cliente",value:"CLIENTE"}),ge=(d,i)=>[d,i];function Ce(d,i){d&1&&(n(0,"tr",33)(1,"th"),s(2,"Tipo"),a(),n(3,"th"),s(4,"Asociado"),a(),n(5,"th"),s(6,"Fecha"),a(),n(7,"th"),s(8,"Condici\xF3n (Parcial/Total)"),a(),n(9,"th"),s(10,"Medio"),a(),n(11,"th"),s(12,"Monto"),a(),n(13,"th"),s(14,"Factura cobrada"),a(),M(15,"th",34),a())}function fe(d,i){if(d&1){let t=T();n(0,"tr",35)(1,"td"),M(2,"p-tag",36),a(),n(3,"td"),s(4),a(),n(5,"td"),s(6),b(7,"date"),a(),n(8,"td",37),s(9),a(),n(10,"td",38),s(11),a(),n(12,"td")(13,"span",39),s(14),b(15,"currency"),a()(),n(16,"td"),M(17,"p-checkbox",40),a(),n(18,"td",41)(19,"p-button",42),f("onClick",function(){let o=v(t).$implicit,r=m(2);return g(r.openModal(o))}),a(),n(20,"p-button",43),f("onClick",function(){let o=v(t).$implicit,r=m(2);return g(r.eliminarMovimiento(o))}),a()()()}if(d&2){let t=i.$implicit,e=i.rowIndex,o=m(2);c("ngClass",e%2===0?"bg-white":"bg-gray-50"),l(2),c("value",o.tipoMovimiento(t))("severity",o.tipoMovimiento(t)==="COBRO"?"success":o.tipoMovimiento(t)==="PAGO"?"danger":"info"),l(2),V(" ",o.proveedorOCliente(t.id_asociado,t.tipo_asociado)," "),l(2),C(h(7,12,t.fecha,"dd/MM/yyyy")),l(3),C(t.forma_pago),l(2),C(t.medio_pago||"Sin especificar"),l(2),c("ngClass",o.tipoMovimiento(t)==="COBRO"?"text-green-600 font-semibold":o.tipoMovimiento(t)==="PAGO"?"text-red-600 font-semibold":"text-gray-800"),l(),A(" ",o.tipoMovimiento(t)==="COBRO"?"+":o.tipoMovimiento(t)==="PAGO"?"-":""," ",h(15,15,t.monto,"ARS")," "),l(3),c("binary",!0)("ngModel",!!t.factura_cobrada)}}function be(d,i){if(d&1&&(n(0,"p-table",24),x(1,Ce,16,0,"ng-template",25)(2,fe,21,18,"ng-template",26),a(),n(3,"div",27)(4,"div",28)(5,"span",29),s(6,"Total Cobros (FC):"),a(),n(7,"span"),s(8),b(9,"currency"),a()(),n(10,"div",28)(11,"span",29),s(12,"Total Pagos (RBOS):"),a(),n(13,"span"),s(14),b(15,"currency"),a()(),n(16,"div",30)(17,"span"),s(18,"Saldo:"),a(),n(19,"span"),s(20),b(21,"currency"),a()(),n(22,"div",31)(23,"span"),s(24,"Saldo cliente"),a(),n(25,"span"),s(26),b(27,"currency"),a()(),n(28,"div",32)(29,"span"),s(30,"Saldo proveedor"),a(),n(31,"span"),s(32),b(33,"currency"),a()()()),d&2){let t=m();c("value",t.transacciones),l(8),C(h(9,6,t.totalCobros,"ARS")),l(6),C(h(15,9,t.totalPagos,"ARS")),l(6),C(h(21,12,t.saldo,"ARS")),l(6),C(h(27,15,t.saldoCliente,"ARS")),l(6),C(h(33,18,t.saldoProveedor,"ARS"))}}function he(d,i){d&1&&(n(0,"div",6),M(1,"i",44),n(2,"p"),s(3,"No hay movimientos registrados para esta obra."),a()())}function Me(d,i){if(d&1){let t=T();n(0,"div",13)(1,"label",11),s(2," Proveedor "),a(),n(3,"p-autoComplete",45),_("ngModelChange",function(o){v(t);let r=m();return u(r.selectedProveedor,o)||(r.selectedProveedor=o),g(o)}),f("completeMethod",function(o){v(t);let r=m();return g(r.filtrarProveedores(o))})("onSelect",function(){v(t);let o=m();return g(o.cargarDatos())}),a()()}if(d&2){let t=m();l(3),p("ngModel",t.selectedProveedor),c("suggestions",t.filteredProveedores)("dropdown",!0)}}function ye(d,i){if(d&1){let t=T();n(0,"div",13)(1,"label",11),s(2," Cliente "),a(),n(3,"p-autoComplete",46),_("ngModelChange",function(o){v(t);let r=m();return u(r.selectedCliente,o)||(r.selectedCliente=o),g(o)}),f("completeMethod",function(o){v(t);let r=m();return g(r.filtrarClientes(o))})("onSelect",function(){v(t);let o=m();return g(o.cargarDatos())}),a()()}if(d&2){let t=m();l(3),p("ngModel",t.selectedCliente),c("suggestions",t.filteredClientes)("dropdown",!0)}}var ue=class d{constructor(i,t,e){this.transaccionesService=i;this.confirmationService=t;this.messageService=e}obraId;clientes;proveedores;obraNombre="";transacciones=[];tiposTransaccion=[];parcial_o_total_options=[{label:"Parcial",name:"PARCIAL"},{label:"Total",name:"TOTAL"}];tipoEntidad="CLIENTE";selectedProveedor=null;selectedCliente=null;filteredProveedores=[];filteredClientes=[];showAddMovementModal=!1;modoEdicion=!1;nuevoMovimiento={id_obra:this.obraId,tipo_transaccion:"COBRO",fecha:new Date().toISOString().split("T")[0],monto:0,forma_pago:"TOTAL",medio_pago:"Transferencia",factura_cobrada:!1,activo:!0,id_asociado:void 0,tipo_asociado:"CLIENTE"};filtrarProveedores(i){let t=i.query.toLowerCase();this.filteredProveedores=this.proveedores.filter(e=>e.nombre.toLowerCase().includes(t))}filtrarClientes(i){let t=i.query.toLowerCase();this.filteredClientes=this.clientes.filter(e=>e.nombre.toLowerCase().includes(t))}proveedorOCliente(i,t){return t==="CLIENTE"?this.clientes.find(e=>e.id===i)?.nombre:t==="PROVEEDOR"?this.proveedores.find(e=>e.id===i)?.nombre:"No se encontr\xF3 un cliente/proveedor asociado"}get totalCobros(){return this.transacciones.filter(i=>this.tipoValue(i)==="COBRO").reduce((i,t)=>i+(t.monto||0),0)}get totalPagos(){return this.transacciones.filter(i=>this.tipoValue(i)==="PAGO").reduce((i,t)=>i+(t.monto||0),0)}get saldo(){return this.totalCobros-this.totalPagos}get saldoCliente(){let i=this.transacciones.filter(e=>(e.tipo_asociado||"").toUpperCase()==="CLIENTE").filter(e=>this.tipoValue(e)==="COBRO").reduce((e,o)=>e+(o.monto||0),0),t=this.transacciones.filter(e=>(e.tipo_asociado||"").toUpperCase()==="CLIENTE").filter(e=>this.tipoValue(e)==="PAGO").reduce((e,o)=>e+(o.monto||0),0);return i-t}get saldoProveedor(){let i=this.transacciones.filter(e=>(e.tipo_asociado||"").toUpperCase()==="PROVEEDOR").filter(e=>this.tipoValue(e)==="COBRO").reduce((e,o)=>e+(o.monto||0),0),t=this.transacciones.filter(e=>(e.tipo_asociado||"").toUpperCase()==="PROVEEDOR").filter(e=>this.tipoValue(e)==="PAGO").reduce((e,o)=>e+(o.monto||0),0);return i-t}ngOnInit(){this.cargarDatos()}cargarDatos(){this.transaccionesService.getByObra(this.obraId).subscribe(i=>{this.transacciones=i.map(t=>this.normalizarTransaccion(t))}),this.transaccionesService.getTipos().subscribe(i=>{this.tiposTransaccion=i})}openModal(i){this.modoEdicion=!!i,this.selectedCliente=null,this.selectedProveedor=null;let t=(i?.tipo_asociado||"CLIENTE").toUpperCase();this.tipoEntidad=t,i?(this.nuevoMovimiento=E(y({},i),{fecha:i.fecha?new Date(i.fecha):new Date,factura_cobrada:!!i.factura_cobrada}),t==="CLIENTE"&&i.id_asociado&&(this.selectedCliente=this.clientes.find(e=>Number(e.id)===Number(i.id_asociado))||null),t==="PROVEEDOR"&&i.id_asociado&&(this.selectedProveedor=this.proveedores.find(e=>Number(e.id)===Number(i.id_asociado))||null)):(this.nuevoMovimiento={id_obra:this.obraId,tipo_transaccion:"COBRO",fecha:new Date().toISOString().split("T")[0],monto:0,forma_pago:"TOTAL",medio_pago:"Transferencia",factura_cobrada:!1,activo:!0,tipo_asociado:"CLIENTE"},this.clientes&&this.clientes.length===1&&(this.selectedCliente=this.clientes[0])),this.showAddMovementModal=!0}cerrarModal(){this.showAddMovementModal=!1}guardarMovimiento(){let i=this.tipoEntidad==="PROVEEDOR"?this.selectedProveedor?.id:this.selectedCliente?.id;if(!i){this.messageService.add({severity:"warn",summary:"Falta asociado",detail:`Selecciona un ${this.tipoEntidad.toLowerCase()}`});return}let t=E(y({},this.nuevoMovimiento),{id_obra:this.obraId,tipo_transaccion:this.nuevoMovimiento.tipo_transaccion,id_asociado:i,tipo_asociado:this.tipoEntidad,factura_cobrada:!!this.nuevoMovimiento.factura_cobrada});t.fecha instanceof Date&&(t.fecha=t.fecha.toISOString().split("T")[0]),(this.modoEdicion?this.transaccionesService.update(t.id,t):this.transaccionesService.create(t)).subscribe({next:o=>{let r=this.normalizarTransaccion(o);this.modoEdicion?this.transacciones=this.transacciones.map(R=>R.id===r.id?r:R):this.transacciones=[r,...this.transacciones],this.showAddMovementModal=!1,this.messageService.add({severity:"success",summary:"\xC9xito",detail:this.modoEdicion?"Movimiento actualizado":"Movimiento creado"})},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo guardar el movimiento"})}})}eliminarMovimiento(i){this.confirmationService.confirm({header:"Confirmar eliminaci\xF3n",message:`\xBFEst\xE1s seguro de que deseas eliminar este movimiento de $${i.monto}?`,icon:"pi pi-exclamation-triangle",acceptLabel:"Eliminar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-danger p-button-sm",rejectButtonStyleClass:"p-button-text p-button-sm",accept:()=>{this.transaccionesService.delete(i.id).subscribe({next:()=>{this.cargarDatos(),this.messageService.add({severity:"success",summary:"Eliminado",detail:"El movimiento fue eliminado correctamente."})},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el movimiento."})}})}})}verPDF(i){if(!(i.factura||i.recibo)){this.messageService.add({severity:"warn",summary:"Sin documento",detail:"No hay documento adjunto."});return}}onUpload(i,t){let e=i.files[0]}tipoValue(i){let t=i.tipo_transaccion;if(typeof t=="string")return t.toUpperCase();if(t&&typeof t.id=="number")return t.id===1?"COBRO":t.id===2?"PAGO":"";let e=(t?.nombre||"").toString().toUpperCase();return e.includes("COBRO")?"COBRO":e.includes("PAGO")?"PAGO":""}tipoMovimiento(i){let t=i.tipo_movimiento||i.tipo_transaccion||"",e=this.tipoValue(i);if(e==="COBRO"||e==="PAGO")return e;let o=t.toString().toUpperCase();return o.includes("COBRO")?"COBRO":o.includes("PAGO")?"PAGO":"MOVIMIENTO"}movimientoEsFactura(i){return(i.tipo_movimiento||i.tipo_transaccion||"").toString().toUpperCase().includes("FACT")}normalizarTransaccion(i){return E(y({},i),{etiqueta:this.tipoValue(i)==="COBRO"?"FC":"RBOS"})}static \u0275fac=function(t){return new(t||d)(S(pe),S(w),S(P))};static \u0275cmp=B({type:d,selectors:[["app-obra-movimientos"]],inputs:{obraId:"obraId",clientes:"clientes",proveedores:"proveedores",obraNombre:"obraNombre"},features:[N([P,w])],decls:43,vars:21,consts:[["position","bottom-right"],[1,"p-4","space-y-5"],[1,"flex","justify-between","items-center","flex-wrap","gap-3"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-500","text-sm","mt-1"],["icon","pi pi-plus","label","Nuevo Movimiento","styleClass","p-button-md p-button-primary",3,"onClick"],[1,"text-center","text-gray-500","py-10","flex","flex-col","items-center","gap-2"],[3,"closed","confirmed","title","visible"],[1,"p-3","space-y-3"],[1,"grid","grid-cols-5","gap-3"],[1,"col-span-2"],[1,"block","text-sm","font-medium","mb-1","text-gray-700"],["placeholder","Seleccionar tipo de entidad","styleClass","w-full",3,"ngModelChange","onChange","ngModel","options"],[1,"col-span-3"],["optionLabel","label","optionValue","name","placeholder","Seleccionar tipo",1,"w-full",3,"ngModelChange","ngModel","options"],["optionLabel","label","optionValue","name","placeholder","Seleccionar condici\xF3n",1,"w-full",3,"ngModelChange","ngModel","options"],["type","text","pInputText","","placeholder","Ej: Transferencia, Efectivo, Cheque",1,"w-full",3,"ngModelChange","ngModel"],[1,"flex","gap-5"],[1,"flex","flex-col","w-1/2"],["currency","ARS","locale","es-AR","mode","currency",1,"w-full",3,"ngModelChange","ngModel"],["appendTo","body","dateFormat","dd/mm/yy",1,"w-full",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","pt-2"],[3,"ngModelChange","ngModel","binary"],[1,"text-sm","text-gray-700"],["responsiveLayout","scroll",1,"text-sm","p-datatable-sm","border","border-gray-200","rounded-lg","overflow-hidden",3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"mt-4","p-4","bg-gray-50","rounded-lg","text-sm","space-y-1"],[1,"flex","justify-between"],[1,"font-medium"],[1,"flex","justify-between","font-semibold","text-base","border-t","pt-2"],[1,"flex","justify-between","text-sm","text-gray-700","pt-2","border-t"],[1,"flex","justify-between","text-sm","text-gray-700"],[1,"bg-gray-50","text-gray-700"],[1,"text-right"],[1,"hover:bg-gray-50","transition",3,"ngClass"],[3,"value","severity"],[1,"uppercase"],[1,"capitalize"],[3,"ngClass"],["disabled","",3,"binary","ngModel"],[1,"flex","justify-end","gap-2","items-center"],["icon","pi pi-pencil","styleClass","p-button-rounded p-button-text p-button-sm","pTooltip","Editar",3,"onClick"],["icon","pi pi-trash","styleClass","p-button-rounded p-button-text p-button-danger p-button-sm","pTooltip","Eliminar",3,"onClick"],[1,"pi","pi-inbox","text-4xl"],["field","nombre","placeholder","Buscar proveedor","styleClass","w-full",3,"ngModelChange","completeMethod","onSelect","ngModel","suggestions","dropdown"],["field","nombre","placeholder","Buscar cliente","styleClass","w-full",3,"ngModelChange","completeMethod","onSelect","ngModel","suggestions","dropdown"]],template:function(t,e){t&1&&(M(0,"p-toast",0)(1,"p-confirmDialog"),n(2,"div",1)(3,"div",2)(4,"div")(5,"h2",3),s(6,"Movimientos"),a(),n(7,"p",4),s(8," Pagos y cobros asociados a la obra "),a()(),n(9,"p-button",5),f("onClick",function(){return e.openModal()}),a()(),x(10,be,34,21)(11,he,4,0,"div",6),n(12,"app-modal",7),f("closed",function(){return e.cerrarModal()})("confirmed",function(){return e.guardarMovimiento()}),n(13,"div",8)(14,"div",9)(15,"div",10)(16,"label",11),s(17," Asociar documento a "),a(),n(18,"p-select",12),_("ngModelChange",function(r){return u(e.tipoEntidad,r)||(e.tipoEntidad=r),r}),f("onChange",function(){return e.cargarDatos()}),a()(),x(19,Me,4,3,"div",13)(20,ye,4,3,"div",13),a(),n(21,"label",11),s(22," Tipo de movimiento "),a(),n(23,"p-select",14),_("ngModelChange",function(r){return u(e.nuevoMovimiento.tipo_transaccion,r)||(e.nuevoMovimiento.tipo_transaccion=r),r}),a(),n(24,"label",11),s(25," Condici\xF3n de pago/cobro (Total/Parcial) "),a(),n(26,"p-select",15),_("ngModelChange",function(r){return u(e.nuevoMovimiento.forma_pago,r)||(e.nuevoMovimiento.forma_pago=r),r}),a(),n(27,"label",11),s(28," Medio de pago/cobro "),a(),n(29,"input",16),_("ngModelChange",function(r){return u(e.nuevoMovimiento.medio_pago,r)||(e.nuevoMovimiento.medio_pago=r),r}),a(),n(30,"div",17)(31,"div",18)(32,"label",11),s(33,"Monto"),a(),n(34,"p-inputNumber",19),_("ngModelChange",function(r){return u(e.nuevoMovimiento.monto,r)||(e.nuevoMovimiento.monto=r),r}),a()(),n(35,"div",18)(36,"label",11),s(37,"Fecha"),a(),n(38,"p-datepicker",20),_("ngModelChange",function(r){return u(e.nuevoMovimiento.fecha,r)||(e.nuevoMovimiento.fecha=r),r}),a()()(),n(39,"div",21)(40,"p-checkbox",22),_("ngModelChange",function(r){return u(e.nuevoMovimiento.factura_cobrada,r)||(e.nuevoMovimiento.factura_cobrada=r),r}),a(),n(41,"label",23),s(42,"Factura cobrada"),a()()()()()),t&2&&(l(10),O(e.transacciones.length>0?10:11),l(2),c("title",e.modoEdicion?"Editar movimiento":"Nuevo movimiento")("visible",e.showAddMovementModal),l(6),p("ngModel",e.tipoEntidad),c("options",L(18,ge,I(16,_e),I(17,ve))),l(),O(e.tipoEntidad==="PROVEEDOR"?19:-1),l(),O(e.tipoEntidad==="CLIENTE"?20:-1),l(3),p("ngModel",e.nuevoMovimiento.tipo_transaccion),c("options",e.tiposTransaccion),l(3),p("ngModel",e.nuevoMovimiento.forma_pago),c("options",e.parcial_o_total_options),l(3),p("ngModel",e.nuevoMovimiento.medio_pago),l(5),p("ngModel",e.nuevoMovimiento.monto),l(4),p("ngModel",e.nuevoMovimiento.fecha),l(2),p("ngModel",e.nuevoMovimiento.factura_cobrada),c("binary",!0))},dependencies:[k,D,F,W,ne,oe,G,Y,X,K,J,Q,z,j,U,q,re,te,ee,se,ie,le,ae,de,me,ce,$,Z,H],encapsulation:2})};export{ue as ObraMovimientosComponent};
