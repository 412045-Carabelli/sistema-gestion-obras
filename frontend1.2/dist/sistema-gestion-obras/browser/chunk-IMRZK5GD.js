import{a as te}from"./chunk-3IQLNM73.js";import{a as ee,b as ae}from"./chunk-KZ3QJ2LT.js";import{a as Y}from"./chunk-XAMQR3BY.js";import{a as Z,b as $}from"./chunk-YHK2U7VT.js";import{a as H}from"./chunk-4BI7NTQR.js";import{a as re}from"./chunk-E4WRTJ72.js";import{b as U,c as X}from"./chunk-WXQODJCJ.js";import"./chunk-BBQRPO7P.js";import{f as J,g as K}from"./chunk-V6H4TXMQ.js";import{l as Q}from"./chunk-VHDVROXF.js";import"./chunk-N52SNE3S.js";import"./chunk-F2X3VGZZ.js";import{b as z,e as j,h as R,o as G,s as q}from"./chunk-IZVSUXNV.js";import"./chunk-LSHC46HD.js";import"./chunk-4BJQ3EOG.js";import"./chunk-MLMYHGGX.js";import"./chunk-42DWQLJE.js";import"./chunk-XQ2VYUTW.js";import"./chunk-MX3PZFJO.js";import"./chunk-LXJ5KELJ.js";import"./chunk-CV2ZWZQE.js";import{E as h,k as W,m as B,r as V}from"./chunk-G4GGURKU.js";import"./chunk-5GYOOLE2.js";import{$b as D,Bb as A,Gb as u,Hb as m,Ma as s,Ra as y,Rb as l,Sb as N,Tb as x,Ub as I,Vb as T,Wb as b,Xb as _,Ya as w,Yb as k,a as c,aa as g,b as C,ba as f,cb as P,hc as F,ic as L,ja as S,lb as p,nb as O,tb as E,ub as M,vb as r,wb as i,xb as v}from"./chunk-HE3ZW6WA.js";var se=(d,t)=>({"pi-check-circle text-green-600":d,"pi-circle text-gray-400":t}),ie=(d,t)=>t.id;function de(d,t){if(d&1&&(r(0,"span",15),l(1),i()),d&2){let a=m();s(),x("\xB7 ",a.obraNombre,"")}}function le(d,t){if(d&1){let a=A();r(0,"div",22),u("click",function(){let n=g(a).$implicit,o=m(2);return f(o.toggleTarea(n))}),r(1,"div",23),v(2,"i",24),r(3,"span"),l(4),i(),v(5,"p-tag",25),F(6,"estadoFormat"),i(),r(7,"div",23)(8,"p-button",26),u("onClick",function(n){let o=g(a).$implicit;return m(2).editarTarea(o),f(n.stopPropagation())}),i(),r(9,"p-button",27),u("onClick",function(n){let o=g(a).$implicit;return m(2).eliminarTarea(o.id),f(n.stopPropagation())}),i()()()}if(d&2){let a=t.$implicit,e=m(2);p("ngClass",e.claseEstado(a)),s(2),p("ngClass",D(9,se,a.estado_tarea==="COMPLETADA",a.estado_tarea!=="COMPLETADA")),s(),O("line-through",a.estado_tarea==="COMPLETADA"),s(),x(" ",a.nombre," "),s(),p("value",L(6,7,a.estado_tarea))("severity",a.estado_tarea==="COMPLETADA"?"success":a.estado_tarea==="EN_PROGRESO"?"info":"warning")}}function pe(d,t){if(d&1&&(r(0,"div",7)(1,"div",16)(2,"div")(3,"h3",17),l(4),i(),r(5,"p",18),l(6),i()()(),v(7,"p-progressBar",19),r(8,"div",20),E(9,le,10,12,"div",21,ie),i()()),d&2){let a=t.$implicit,e=m();s(4),N(a.nombre),s(2),I(" ",e.getCompletadas(a.id)," / ",e.getTotales(a.id)," completadas "),s(),p("value",e.progreso(a.id)),s(2),M(e.tareasProveedor(a.id))}}var oe=class d{constructor(t,a){this.tareasService=t;this.messageService=a}obraId;proveedores=[];tareas=[];obraNombre="";tareasActualizadas=new S;estadoOptions=[{label:"Pendiente",value:"PENDIENTE"},{label:"En progreso",value:"EN_PROGRESO"},{label:"Completada",value:"COMPLETADA"}];showAddTaskModal=!1;editandoTarea=null;nuevaTarea={};abrirModal(){this.nuevaTarea={proveedor:this.proveedores[0]??null,estado_tarea:"PENDIENTE"},this.editandoTarea=null,this.showAddTaskModal=!0}cerrarModal(){this.showAddTaskModal=!1,this.editandoTarea=null}guardarTarea(){if(!this.nuevaTarea.nombre||!this.nuevaTarea.proveedor){this.messageService.add({severity:"warn",summary:"Campos incompletos",detail:"Debe ingresar un nombre y un proveedor"});return}let t={id:this.editandoTarea?.id,id_obra:this.obraId,id_proveedor:this.nuevaTarea.proveedor.id,estado_tarea:this.nuevaTarea.estado_tarea||"PENDIENTE",nombre:this.nuevaTarea.nombre,descripcion:this.nuevaTarea.descripcion};(this.editandoTarea?.id?this.tareasService.updateTarea(this.editandoTarea.id,t):this.tareasService.createTarea(t)).subscribe({next:e=>{this.editandoTarea?.id?this.tareas=this.tareas.map(n=>n.id===e.id?C(c(c({},n),e),{proveedor:this.nuevaTarea.proveedor}):n):this.tareas=[...this.tareas,C(c({},e),{proveedor:this.nuevaTarea.proveedor})],this.tareasActualizadas.emit(this.tareas),this.showAddTaskModal=!1},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo guardar la tarea"})}})}toggleTarea(t){this.tareasService.completarTarea(t.id,this.obraId).subscribe({next:a=>{this.tareas=this.tareas.map(e=>e.id===t.id?c(c({},e),a):e),this.tareasActualizadas.emit(this.tareas)},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo actualizar la tarea"})}})}eliminarTarea(t){this.tareasService.deleteTarea(t,this.obraId).subscribe({next:()=>{this.tareas=this.tareas.filter(a=>a.id!==t),this.tareasActualizadas.emit(this.tareas),this.messageService.add({severity:"success",summary:"Tarea eliminada",detail:"La tarea fue eliminada correctamente"})},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la tarea"})}})}tareasProveedor(t){return this.tareas.filter(a=>a.proveedor?.id===t)}progreso(t){let a=this.tareasProveedor(t);if(!a.length)return 0;let e=a.filter(n=>n.estado_tarea==="COMPLETADA").length;return Math.round(e/a.length*100)}getCompletadas(t){return this.tareasProveedor(t).filter(a=>a.estado_tarea==="COMPLETADA").length}getTotales(t){return this.tareasProveedor(t).length}claseEstado(t){switch(t.estado_tarea){case"COMPLETADA":return"bg-green-50 border-green-200";case"PENDIENTE":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200 hover:bg-gray-100"}}editarTarea(t){this.editandoTarea=t,this.nuevaTarea={id:t.id,nombre:t.nombre,descripcion:t.descripcion,estado_tarea:t.estado_tarea,proveedor:t.proveedor},this.showAddTaskModal=!0}static \u0275fac=function(a){return new(a||d)(y(re),y(h))};static \u0275cmp=w({type:d,selectors:[["app-obra-tareas"]],inputs:{obraId:"obraId",proveedores:"proveedores",tareas:"tareas",obraNombre:"obraNombre"},outputs:{tareasActualizadas:"tareasActualizadas"},features:[k([h])],decls:26,vars:9,consts:[[1,"flex","flex-col","gap-3"],[1,"flex","w-full","justify-between","items-center"],[1,"p-5"],[1,"text-2xl","font-semibold","text-black"],[1,"text-gray-600"],["class","font-semibold text-gray-800",4,"ngIf"],["icon","pi pi-plus","label","Nueva Tarea",3,"onClick"],[1,"rounded-lg","p-5","bg-gray-50"],[3,"closed","confirmed","visible","title"],[1,"p-3","space-y-3"],[1,"block","text-sm","font-medium"],["pInputText","","type","text",1,"w-full",3,"ngModelChange","ngModel"],["rows","3","placeholder","Detalle o notas de la tarea",1,"w-full","p-2","border","rounded-md",3,"ngModelChange","ngModel"],["appendTo","body","optionLabel","nombre","placeholder","Seleccionar proveedor",1,"w-full",3,"ngModelChange","ngModel","options"],["optionLabel","label","optionValue","value","appendTo","body","placeholder","Seleccionar estado",1,"w-full",3,"ngModelChange","ngModel","options"],[1,"font-semibold","text-gray-800"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-semibold","text-xl","text-gray-800"],[1,"text-sm","text-gray-700"],[3,"value"],[1,"space-y-2","mt-3"],[1,"flex","justify-between","items-center","border","rounded-md","p-2","cursor-pointer",3,"ngClass"],[1,"flex","justify-between","items-center","border","rounded-md","p-2","cursor-pointer",3,"click","ngClass"],[1,"flex","items-center","gap-2"],[1,"pi","text-lg",3,"ngClass"],["styleClass","text-xs",3,"value","severity"],["icon","pi pi-pencil","styleClass","p-button-text p-button-sm",3,"onClick"],["icon","pi pi-trash","styleClass","p-button-text p-button-sm text-red-500",3,"onClick"]],template:function(a,e){a&1&&(v(0,"p-toast"),r(1,"div",0)(2,"div",1)(3,"div",2)(4,"h1",3),l(5,"Gesti\xF3n de tareas"),i(),r(6,"p",4),l(7,"Progreso por proveedor "),P(8,de,2,1,"span",5),i()(),r(9,"p-button",6),u("onClick",function(){return e.abrirModal()}),i()(),E(10,pe,11,4,"div",7,ie),r(12,"app-modal",8),u("closed",function(){return e.cerrarModal()})("confirmed",function(){return e.guardarTarea()}),r(13,"div",9)(14,"label",10),l(15,"Nombre de la tarea"),i(),r(16,"input",11),_("ngModelChange",function(o){return b(e.nuevaTarea.nombre,o)||(e.nuevaTarea.nombre=o),o}),i(),r(17,"label",10),l(18,"Descripci\xF3n"),i(),r(19,"textarea",12),_("ngModelChange",function(o){return b(e.nuevaTarea.descripcion,o)||(e.nuevaTarea.descripcion=o),o}),i(),r(20,"label",10),l(21,"Proveedor"),i(),r(22,"p-select",13),_("ngModelChange",function(o){return b(e.nuevaTarea.proveedor,o)||(e.nuevaTarea.proveedor=o),o}),i(),r(23,"label",10),l(24,"Estado"),i(),r(25,"p-select",14),_("ngModelChange",function(o){return b(e.nuevaTarea.estado_tarea,o)||(e.nuevaTarea.estado_tarea=o),o}),i()()()()),a&2&&(s(8),p("ngIf",e.obraNombre),s(2),M(e.proveedores),s(2),p("visible",e.showAddTaskModal)("title",e.editandoTarea?"Editar Tarea":"Nueva Tarea"),s(4),T("ngModel",e.nuevaTarea.nombre),s(3),T("ngModel",e.nuevaTarea.descripcion),s(3),T("ngModel",e.nuevaTarea.proveedor),p("options",e.proveedores),s(3),T("ngModel",e.nuevaTarea.estado_tarea),p("options",e.estadoOptions))},dependencies:[V,W,B,K,J,$,Z,H,X,U,Y,G,z,j,R,q,Q,ae,ee,te],encapsulation:2})};export{oe as ObraTareasComponent};
