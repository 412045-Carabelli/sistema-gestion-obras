
<div class="p-6 space-y-6 max-w-5xl mx-auto bg-white rounded-xl shadow-sm">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Nombre -->
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-gray-700">Nombre</label>
        <input pInputText formControlName="nombre" placeholder="Ej. Proyecto X" class="w-full" />
        @if (form.get('nombre')?.touched && form.get('nombre')?.hasError('required')) {
          <small class="text-red-500 text-xs mt-1">Campo obligatorio</small>
        }
      </div>

      <!-- Cliente (objeto) -->
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-gray-700">Cliente</label>
        <p-select
          formControlName="cliente"
          [options]="clientes"
          optionLabel="nombre"
          placeholder="Selecciona un cliente"
          appendTo="body"
          class="w-full"
        ></p-select>
        @if (form.get('cliente')?.touched && form.get('cliente')?.hasError('required')) {
          <small class="text-red-500 text-xs mt-1">Selecciona un cliente</small>
        }
      </div>

      <!-- Estado de Obra (objeto) -->
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-gray-700">Estado</label>
        <p-select
          formControlName="obra_estado"
          [options]="estadosObra"
          optionLabel="nombre"
          placeholder="Selecciona un estado"
          appendTo="body"
          class="w-full"
        ></p-select>
        @if (form.get('obra_estado')?.touched && form.get('obra_estado')?.hasError('required')) {
          <small class="text-red-500 text-xs mt-1">Selecciona un estado</small>
        }
      </div>

      <!-- Dirección -->
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-gray-700">Dirección</label>
        <input pInputText formControlName="direccion" placeholder="Ej. Av. San Martín 1234" class="w-full" />
        @if (form.get('direccion')?.touched && form.get('direccion')?.hasError('required')) {
          <small class="text-red-500 text-xs mt-1">Campo obligatorio</small>
        }
      </div>

      <!-- Fechas -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700">Fecha de inicio</label>
          <p-datepicker
            formControlName="fecha_inicio"
            dateFormat="dd/mm/yy"
            showIcon="true"
            inputId="fechaInicio"
            appendTo="body"
            class="w-full"
          ></p-datepicker>
          @if (form.get('fecha_inicio')?.touched && form.get('fecha_inicio')?.hasError('required')) {
            <small class="text-red-500 text-xs mt-1">Campo obligatorio</small>
          }
        </div>

        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700">Fecha de fin (opcional)</label>
          <p-datepicker
            formControlName="fecha_fin"
            dateFormat="dd/mm/yy"
            showIcon="true"
            inputId="fechaFin"
            appendTo="body"
            class="w-full"
          ></p-datepicker>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700">Fecha adjudicada (opcional)</label>
          <p-datepicker
            formControlName="fecha_adjudicada"
            dateFormat="dd/mm/yy"
            showIcon="true"
            inputId="fechaAdjudicada"
            appendTo="body"
            class="w-full"
          ></p-datepicker>
        </div>

        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700">Fecha perdida (opcional)</label>
          <p-datepicker
            formControlName="fecha_perdida"
            dateFormat="dd/mm/yy"
            showIcon="true"
            inputId="fechaPerdida"
            appendTo="body"
            class="w-full"
          ></p-datepicker>
        </div>
      </div>

      <!-- Presupuesto -->
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-gray-700">Presupuesto</label>
        <input pInputText formControlName="presupuesto" class="w-full" readonly />
      </div>

      <div class="flex gap-5">
        <!-- Beneficio Global -->
        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700 flex items-center justify-between">
            <span>Beneficio Global</span>
          </label>
          <div class="flex items-center gap-2">
            <p-checkbox
              binary="true"
              formControlName="beneficio_global"
              inputId="beneficioGlobal"
              class="py-3"
            ></p-checkbox>

            <input
              type="number"
              pInputText
              formControlName="beneficio"
              class="w-18"
              placeholder="%"
            />

            <span class="text-gray-500 text-xs">
              <strong class="text-xl">%</strong> aplicado a todos los costos
            </span>
          </div>
        </div>
        <!-- Comisión Global -->
        <div class="flex flex-col">
          <label class="text-sm font-medium mb-1 text-gray-700 flex items-center justify-between">
            <span>Comisión</span>
          </label>

          <div class="flex items-center gap-2">
            <p-checkbox
              binary="true"
              formControlName="tiene_comision"
              inputId="tieneComision"
              class="py-3"
            ></p-checkbox>

            <input
              type="number"
              pInputText
              formControlName="comision"
              class="w-18"
              placeholder="%"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de costos (opcional durante creación) -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Matriz de Costos</h3>

      <app-obra-costos-table
        [costos]="costos"
        [modoEdicion]="false"
        [proveedores]="proveedores"
        (agregarFila)="nuevaFilaCosto()"
      >
      </app-obra-costos-table>


      <div class="mt-3">
        <p-button
          icon="pi pi-plus"
          label="Agregar fila de costo"
          styleClass="p-button-sm p-button-outlined"
          (onClick)="nuevaFilaCosto()"
          type="button"
        ></p-button>
      </div>
    </div>

    <!-- Botón Guardar -->
    <div class="flex justify-end mt-6">
      <p-button
        label="Guardar Obra"
        icon="pi pi-save"
        styleClass="p-button-primary"
        type="submit"
        [disabled]="form.invalid"
      ></p-button>
    </div>
  </form>
</div>
