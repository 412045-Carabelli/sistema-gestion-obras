<div class="mt-4 rounded-lg overflow-hidden shadow-sm">
  <p-table
    [value]="costos.controls"
    [tableStyle]="{ 'min-width': '100%' }"
    class="w-full text-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th class="px-3 py-2 text-left w-48">Proveedor</th>
        <th class="px-3 py-2 text-left w-64">Descripci√≥n</th>
        <th class="px-3 py-2 text-right w-20">Cantidad</th>
        <th class="px-3 py-2 text-right w-20">Uni. Med.</th>
        <th class="px-3 py-2 text-right w-32">Precio Unitario</th>
        <th class="px-3 py-2 text-right w-28">Beneficio (%)</th>
        <th class="px-3 py-2 text-right w-32">Total</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body">
      @for (fila of costos.controls; track i; let i = $index) {
        <tr [formGroup]="fila" class="border-t">

          <!-- üßæ PROVEEDOR -->
          <td class="px-2 py-1 w-48">
            @if (!modoEdicion) {
              <p-select
                [options]="proveedores"
                optionLabel="nombre"
                optionValue="id"
                formControlName="id_proveedor"
                placeholder="Seleccionar"
                appendTo="body"
                styleClass="w-full"
              ></p-select>
            } @else {
              {{ getProveedorNombre(fila.get('id_proveedor')?.value) }}
            }
          </td>

          <!-- üìù DESCRIPCI√ìN -->
          <td class="px-2 py-1 w-64">
            @if (!modoEdicion) {
              <input pInputText formControlName="descripcion" placeholder="Descripci√≥n" class="w-full" />
            } @else {
              {{ fila.get('descripcion')?.value }}
            }
          </td>

          <!-- üìä CANTIDAD -->
          <td class="px-2 py-1 text-right w-18">
            @if (!modoEdicion) {
              <input type="number" pInputText formControlName="cantidad" class="w-full text-right" />
            } @else {
              {{ fila.get('cantidad')?.value }}
            }
          </td>

          <td class="px-2 py-1 w-26">
            @if (!modoEdicion) {
              <input pInputText formControlName="unidad" placeholder="Ej. m2" class="w-full" />
            } @else {
              {{ fila.get('unidad')?.value }}
            }
          </td>

          <!-- üí∞ PRECIO UNITARIO -->
          <td class="px-2 py-1 text-right w-32">
            @if (!modoEdicion) {
              <input type="number" pInputText formControlName="precio_unitario" class="w-full text-right" />
            } @else {
              {{ fila.get('precio_unitario')?.value | currency:'ARS' }}
            }
          </td>

          <!-- üìà BENEFICIO -->
          <td class="px-2 py-1 text-right w-28">
            @if (!modoEdicion) {
              <input type="number" pInputText formControlName="beneficio" class="w-full text-right" />
            } @else {
              {{ fila.get('beneficio')?.value ?? 0 }}%
            }
          </td>

          <!-- üü¢ TOTAL -->
          <td class="px-2 py-1 text-right font-semibold text-green-700 w-32">
            {{ fila.get('total')?.value | currency:'ARS' }}
          </td>
        </tr>
      }
    </ng-template>

    <ng-template pTemplate="footer">
      <tr class="font-semibold border-t bg-gray-50">
        <td colspan="6" class="text-right px-3 py-2">TOTAL GENERAL:</td>
        <td class="text-right px-3 py-2 text-green-700">
          {{ calcularTotalGeneral() | currency:'ARS' }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
